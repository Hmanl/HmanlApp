{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\subCanvas.js"],"names":["cc","Class","extends","Component","properties","prefabs","Prefab","texs","SpriteFrame","stamp","eStamp","start","node","setContentSize","winSize","update","createRank","sharedCanvas","rank","instantiate","parent","selfNode","children","content","lx","getUserInfo","tokens","success","bind","tex","Texture2D","initWithElement","handleLoadedTexture","getComponent","Sprite","spriteFrame","info","nickName","nick","key","config","platform","getFriendCloudStorage","console","log","length","k","j","score","parseInt","kvdata","value","game","score2","temp","panel","i","writeInfo","sprite","getChildByName","createImage","headimg","Label","string","toString","range","Math","floor","language","url","utils","loadImage","image","texture"],"mappings":"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","file":"subCanvas.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties:{\r\n        prefabs:[cc.Prefab],\r\n        texs:[cc.SpriteFrame],\r\n        stamp:[cc.SpriteFrame],\r\n        eStamp:[cc.SpriteFrame],\r\n    },\r\n\r\n    start () {     \r\n        this.node.setContentSize(cc.winSize);\r\n    },\r\n    \r\n    update () {\r\n        this.createRank();\r\n    },\r\n\r\n    createRank(){\r\n        if(typeof(sharedCanvas) == 'undefined'){\r\n            if(!this.rank){\r\n                this.rank = cc.instantiate(this.prefabs[0]);                \r\n                this.rank.parent = this.node;                \r\n                this.selfNode = this.rank.children[1];\r\n                this.content = this.rank.children[0].children[1].children[0];\r\n                lx.getUserInfo({\r\n                    tokens:['selfToken'],\r\n                    success:this.getUserInfo.bind(this),\r\n                });                \r\n            }\r\n        }else{\r\n            if (!this.tex) {\r\n                this.tex = new cc.Texture2D();\r\n            }\r\n            this.tex.initWithElement(sharedCanvas);\r\n            this.tex.handleLoadedTexture();\r\n            this.node.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(this.tex);\r\n        }\r\n    },\r\n\r\n    getUserInfo:function(info){\r\n        this.nickName = info[0].nick;   \r\n        var key = lx.config.platform == \"fbinstant\" ? 'user_score' : \"userScore\";      \r\n        lx.getFriendCloudStorage({\r\n            key: key,\r\n            success:this.getFriendCloudStorage.bind(this),            \r\n        });              \r\n    },\r\n\r\n    getFriendCloudStorage:function(info){ \r\n        console.log(\"好友信息\",info);  \r\n        if(info.length <= 0) return;                \r\n        for(var k = 0;k<info.length-1;k++){\r\n            for(var j = 0;j<info.length-1-k;j++){\r\n                var score = parseInt(info[j].kvdata.value.game.score);\r\n                var score2 = parseInt(info[j+1].kvdata.value.game.score);                \r\n                if(score<score2){\r\n                    var temp = info[j+1];\r\n                    info[j+1] = info[j];\r\n                    info[j] = temp;\r\n                } \r\n            }\r\n        }\r\n        var panel = null;\r\n        for(var i = 0;i < info.length;i++){           \r\n            panel = (i+2)%2 == 0 ? cc.instantiate(this.prefabs[1]) : cc.instantiate(this.prefabs[2]);\r\n            this.writeInfo(panel,info[i],i);                           \r\n            if(info[i].nick == this.nickName){\r\n                this.writeInfo(this.selfNode,info[i],i);\r\n            }\r\n            panel.parent = this.content;           \r\n        }\r\n    },\r\n\r\n    writeInfo(node,info,i){        \r\n        var sprite = node.getChildByName(\"avatar\").getComponent(cc.Sprite);\r\n        this.createImage(sprite,info.headimg);  \r\n        node.getChildByName(\"name\").getComponent(cc.Label).string = info.nick;\r\n        node.getChildByName(\"score\").getComponent(cc.Label).string = info.kvdata.value.game.score;            \r\n        node.getChildByName(\"rank\").getComponent(cc.Label).string = (i+1).toString();        \r\n        if(i<3)\r\n        node.getChildByName(\"rank2\").getComponent(cc.Sprite).spriteFrame = this.texs[i];\r\n        var range = Math.floor(info.kvdata.value.game.score/200);\r\n        var range = Math.floor(4,range);\r\n        if(lx.language==\"zh\"){\r\n            //中文\r\n            node.getChildByName(\"stamp\").getComponent(cc.Sprite).spriteFrame = this.stamp[range];\r\n        }                \r\n        else{\r\n            //英文\r\n            node.getChildByName(\"stamp\").getComponent(cc.Sprite).spriteFrame = this.eStamp[range];     \r\n        }\r\n        \r\n                       \r\n        // if(info.KVDataList[1]){           \r\n        //     var obj = JSON.parse(info.KVDataList[1].value);        \r\n        //     if(obj.type == 0){                \r\n        //         var g = this.userInfo.gender;\r\n        //         if(g == 0)\r\n        //         g = 1;\r\n        //         var robotInfo = this.robots[g - 1][obj.value];\r\n        //         var sprite3 = node.getChildByName('avatar2').getComponent(cc.Sprite);\r\n        //         this.setSprite(sprite3,robotInfo.avatar);            \r\n        //     }else{\r\n        //         var sprite2 = node.getChildByName('avatar2').getComponent(cc.Sprite);\r\n        //         this.createImage(sprite2,obj.value);\r\n        //     }\r\n        // }\r\n    },\r\n\r\n    // setSprite(sprite,icon){\r\n    //     cc.loader.loadRes(icon, cc.SpriteFrame, function (err, spriteFrame) {\r\n    //         sprite.spriteFrame = spriteFrame;\r\n    //     });\r\n    // },\r\n\r\n    createImage: function(sprite, url){\r\n        lx.utils.loadImage({\r\n            url: url,\r\n            success : function(image){\r\n                var texture = new cc.Texture2D();\r\n                texture.initWithElement(image);\r\n                texture.handleLoadedTexture();\r\n                sprite.spriteFrame = new cc.SpriteFrame(texture);\r\n            }\r\n        });\r\n    },\r\n\r\n    // loadRobotInfo(){\r\n    //     var male = new Array();\r\n    //     var female = new Array();\r\n    //     this.robots = new Array(male,female);        \r\n    //     this.createRobot(1,'avatar/0','無悪不作');        \r\n    //     this.createRobot(0,'avatar/1','兔兔');\r\n    //     this.createRobot(1,'avatar/2','佛爷');\r\n    //     this.createRobot(1,'avatar/3','吧唧先生');\r\n    //     this.createRobot(0,'avatar/4','小兔几');\r\n    //     this.createRobot(0,'avatar/5','很酷只撩你');\r\n    //     this.createRobot(1,'avatar/6','油焖大侠');\r\n    //     this.createRobot(0,'avatar/7','浅浅淡淡');\r\n    //     this.createRobot(0,'avatar/8','柒七');\r\n    //     this.createRobot(0,'avatar/9','灯下孤影');\r\n    // },\r\n\r\n    // createRobot(type,path,nickName){    \r\n    //     var robot = {\r\n    //         avatar:path,\r\n    //         nickName:nickName,\r\n    //     };\r\n    //     this.robots[type].push(robot);\r\n    // }, \r\n\r\n});\r\n"]}