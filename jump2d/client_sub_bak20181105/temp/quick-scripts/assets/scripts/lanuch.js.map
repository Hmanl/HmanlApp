{"version":3,"sources":["lanuch.js"],"names":["cc","Class","extends","Component","properties","content","Node","prefabs","Prefab","selfNode","rng","SpriteFrame","stamp","start","loadRobotInfo","_show","wx","onMessage","currScore","parseInt","data","message","friendUrl","url","getUserCloudStorage","keyList","success","bind","removeAllChildren","getUserInfo","openIdList","info","userInfo","getFriendCloudStorage","console","log","length","k","j","score","KVDataList","value","score2","temp","i","panel","instantiate","writeInfo","nickname","nickName","parent","node","sprite","getChildByName","getComponent","Sprite","createImage","avatarUrl","Label","string","toString","spriteFrame","range","Math","floor","obj","JSON","parse","type","g","gender","robotInfo","robots","sprite3","setSprite","avatar","sprite2","icon","loader","loadRes","err","image","onload","texture","Texture2D","initWithElement","handleLoadedTexture","src","maxScore","key","obj2","lx","setUserCloudStorage","male","Array","female","createRobot","path","robot","push"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAAQL,GAAGM,IADH;AAERC,iBAAQ,CAACP,GAAGQ,MAAJ,CAFA;AAGRC,kBAAST,GAAGM,IAHJ;AAIRI,aAAI,CAACV,GAAGW,WAAJ,CAJI;AAKRC,eAAM,CAACZ,GAAGW,WAAJ;AALE,KAHP;;AAWLE,SAXK,mBAWI;AAAA;;AACL,aAAKC,aAAL;AACA,aAAKC,KAAL;AACAC,WAAGC,SAAH,CAAa,gBAAQ;AACjB,kBAAKC,SAAL,GAAiBC,SAASC,KAAKC,OAAd,CAAjB;AACA,kBAAKC,SAAL,GAAiBF,KAAKG,GAAtB;AACAP,eAAGQ,mBAAH,CAAuB;AACnBC,yBAAQ,CAAC,OAAD,CADW;AAEnBC,yBAAQ,MAAKF,mBAAL,CAAyBG,IAAzB;AAFW,aAAvB;AAIH,SAPD;AAQH,KAtBI;AAwBLZ,SAxBK,mBAwBI;AACL,aAAKV,OAAL,CAAauB,iBAAb;AACAZ,WAAGa,WAAH,CAAe;AACXC,wBAAW,CAAC,YAAD,CADA;AAEXJ,qBAAQ,KAAKG,WAAL,CAAiBF,IAAjB,CAAsB,IAAtB;AAFG,SAAf;AAIH,KA9BI;;;AAgCLE,iBAAY,qBAASE,IAAT,EAAc;AACtB,aAAKC,QAAL,GAAgBD,KAAKX,IAAL,CAAU,CAAV,CAAhB;AACAJ,WAAGiB,qBAAH,CAAyB;AACrBR,qBAAQ,CAAC,OAAD,EAAS,SAAT,CADa;AAErBC,qBAAQ,KAAKO,qBAAL,CAA2BN,IAA3B,CAAgC,IAAhC;AAFa,SAAzB;AAIH,KAtCI;;AAwCLM,2BAAsB,+BAASF,IAAT,EAAc;AAChCG,gBAAQC,GAAR,CAAY,OAAZ,EAAoBJ,IAApB;AACA,YAAGA,KAAKK,MAAL,IAAe,CAAlB,EAAqB;AACrB,aAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAIN,KAAKX,IAAL,CAAUgB,MAAV,GAAiB,CAApC,EAAuCC,GAAvC,EAA2C;AACvC,iBAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAIP,KAAKX,IAAL,CAAUgB,MAAV,GAAiB,CAAjB,GAAmBC,CAArC,EAAwCC,GAAxC,EAA4C;AACxC,oBAAIC,QAAQpB,SAASY,KAAKX,IAAL,CAAUkB,CAAV,EAAaE,UAAb,CAAwB,CAAxB,EAA2BC,KAApC,CAAZ;AACA,oBAAIC,SAASvB,SAASY,KAAKX,IAAL,CAAUkB,IAAE,CAAZ,EAAeE,UAAf,CAA0B,CAA1B,EAA6BC,KAAtC,CAAb;AACA,oBAAGF,QAAMG,MAAT,EAAgB;AACZ,wBAAIC,OAAOZ,KAAKX,IAAL,CAAUkB,IAAE,CAAZ,CAAX;AACAP,yBAAKX,IAAL,CAAUkB,IAAE,CAAZ,IAAiBP,KAAKX,IAAL,CAAUkB,CAAV,CAAjB;AACAP,yBAAKX,IAAL,CAAUkB,CAAV,IAAeK,IAAf;AACH;AAEJ;AACJ;;AAED,aAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAIb,KAAKX,IAAL,CAAUgB,MAA5B,EAAmCQ,GAAnC,EAAuC;AACnC,gBAAIC,QAAQ,IAAZ;AACA,aAACD,IAAE,CAAH,IAAM,CAAN,IAAW,CAAX,GAAaC,QAAQ7C,GAAG8C,WAAH,CAAe,KAAKvC,OAAL,CAAa,CAAb,CAAf,CAArB,GAAqDsC,QAAQ7C,GAAG8C,WAAH,CAAe,KAAKvC,OAAL,CAAa,CAAb,CAAf,CAA7D;AACA,iBAAKwC,SAAL,CAAeF,KAAf,EAAqBd,KAAKX,IAAL,CAAUwB,CAAV,CAArB,EAAkCA,CAAlC;AACA,gBAAGb,KAAKX,IAAL,CAAUwB,CAAV,EAAaI,QAAb,IAAyB,KAAKhB,QAAL,CAAciB,QAA1C,EAAmD;AAC/C,qBAAKF,SAAL,CAAe,KAAKtC,QAApB,EAA6BsB,KAAKX,IAAL,CAAUwB,CAAV,CAA7B,EAA0CA,CAA1C;AACH;AACDC,kBAAMK,MAAN,GAAe,KAAK7C,OAApB;AACH;AACJ,KAjEI;;AAmEL0C,aAnEK,qBAmEKI,IAnEL,EAmEUpB,IAnEV,EAmEea,CAnEf,EAmEiB;AAClB,YAAIQ,SAASD,KAAKE,cAAL,CAAoB,QAApB,EAA8BC,YAA9B,CAA2CtD,GAAGuD,MAA9C,CAAb;AACA,aAAKC,WAAL,CAAiBJ,MAAjB,EAAwBrB,KAAK0B,SAA7B;AACAN,aAAKE,cAAL,CAAoB,MAApB,EAA4BC,YAA5B,CAAyCtD,GAAG0D,KAA5C,EAAmDC,MAAnD,GAA4D5B,KAAKiB,QAAjE;AACAG,aAAKE,cAAL,CAAoB,OAApB,EAA6BC,YAA7B,CAA0CtD,GAAG0D,KAA7C,EAAoDC,MAApD,GAA6D5B,KAAKS,UAAL,CAAgB,CAAhB,EAAmBC,KAAhF;AACAU,aAAKE,cAAL,CAAoB,MAApB,EAA4BC,YAA5B,CAAyCtD,GAAG0D,KAA5C,EAAmDC,MAAnD,GAA4D,CAACf,IAAE,CAAH,EAAMgB,QAAN,EAA5D;AACA,YAAGhB,IAAE,CAAL,EACAO,KAAKE,cAAL,CAAoB,OAApB,EAA6BC,YAA7B,CAA0CtD,GAAGuD,MAA7C,EAAqDM,WAArD,GAAmE,KAAKnD,GAAL,CAASkC,CAAT,CAAnE;AACA,YAAIkB,QAAQC,KAAKC,KAAL,CAAWjC,KAAKS,UAAL,CAAgB,CAAhB,EAAmBC,KAAnB,GAAyB,GAApC,CAAZ;AACA,YAAGqB,QAAM,CAAT,EACAX,KAAKE,cAAL,CAAoB,OAApB,EAA6BC,YAA7B,CAA0CtD,GAAGuD,MAA7C,EAAqDM,WAArD,GAAmE,KAAKjD,KAAL,CAAWkD,KAAX,CAAnE;AACA,YAAG/B,KAAKS,UAAL,CAAgB,CAAhB,CAAH,EAAsB;AAClB,gBAAIyB,MAAMC,KAAKC,KAAL,CAAWpC,KAAKS,UAAL,CAAgB,CAAhB,EAAmBC,KAA9B,CAAV;AACA,gBAAGwB,IAAIG,IAAJ,IAAY,CAAf,EAAiB;AACb,oBAAIC,IAAI,KAAKrC,QAAL,CAAcsC,MAAtB;AACA,oBAAGD,KAAK,CAAR,EACAA,IAAI,CAAJ;AACA,oBAAIE,YAAY,KAAKC,MAAL,CAAYH,IAAI,CAAhB,EAAmBJ,IAAIxB,KAAvB,CAAhB;AACA,oBAAIgC,UAAUtB,KAAKE,cAAL,CAAoB,SAApB,EAA+BC,YAA/B,CAA4CtD,GAAGuD,MAA/C,CAAd;AACA,qBAAKmB,SAAL,CAAeD,OAAf,EAAuBF,UAAUI,MAAjC;AACH,aAPD,MAOK;AACD,oBAAIC,UAAUzB,KAAKE,cAAL,CAAoB,SAApB,EAA+BC,YAA/B,CAA4CtD,GAAGuD,MAA/C,CAAd;AACA,qBAAKC,WAAL,CAAiBoB,OAAjB,EAAyBX,IAAIxB,KAA7B;AACH;AACJ;AACJ,KA5FI;AA8FLiC,aA9FK,qBA8FKtB,MA9FL,EA8FYyB,IA9FZ,EA8FiB;AAClB7E,WAAG8E,MAAH,CAAUC,OAAV,CAAkBF,IAAlB,EAAwB7E,GAAGW,WAA3B,EAAwC,UAAUqE,GAAV,EAAenB,WAAf,EAA4B;AAChET,mBAAOS,WAAP,GAAqBA,WAArB;AACH,SAFD;AAGH,KAlGI;;;AAoGLL,iBAAa,qBAASJ,MAAT,EAAiB7B,GAAjB,EAAqB;AAC9B,YAAGA,GAAH,EAAO;AACH,gBAAI0D,QAAQjE,GAAGwC,WAAH,EAAZ;AACAyB,kBAAMC,MAAN,GAAe,YAAY;AACvB,oBAAIC,UAAU,IAAInF,GAAGoF,SAAP,EAAd;AACAD,wBAAQE,eAAR,CAAwBJ,KAAxB;AACAE,wBAAQG,mBAAR;AACAlC,uBAAOS,WAAP,GAAqB,IAAI7D,GAAGW,WAAP,CAAmBwE,OAAnB,CAArB;AACH,aALD;AAMAF,kBAAMM,GAAN,GAAYhE,GAAZ;AACH;AACJ,KA/GI;;AAiHLC,yBAAoB,6BAASJ,IAAT,EAAc;AAC9B,YAAIoE,WAAW,CAAf;AACA,YAAGpE,KAAKoB,UAAL,CAAgB,CAAhB,CAAH,EAAsB;AAClB,gBAAIgD,WAAWrE,SAASC,KAAKoB,UAAL,CAAgB,CAAhB,EAAmBC,KAA5B,CAAf;AACH;AACD,YAAG,KAAKvB,SAAL,GAAiBsE,QAApB,EAA6B;AACzB,gBAAIvB,MAAM;AACNwB,qBAAI,OADE;AAENhD,uBAAM,KAAKvB,SAAL,CAAe0C,QAAf;AAFA,aAAV;;AAKA,gBAAI8B,OAAO;AACPD,qBAAI,SADG;AAEPhD,uBAAM,KAAKnB;AAFJ,aAAX;AAIAqE,eAAGC,mBAAH,CAAuB;AACnBpD,4BAAW,CAACyB,GAAD,EAAKyB,IAAL;;AADQ,aAAvB;AAIA,iBAAK3E,KAAL;AACH;AACJ,KAtII;;AAwILD,iBAxIK,2BAwIU;AACX,YAAI+E,OAAO,IAAIC,KAAJ,EAAX;AACA,YAAIC,SAAS,IAAID,KAAJ,EAAb;AACA,aAAKtB,MAAL,GAAc,IAAIsB,KAAJ,CAAUD,IAAV,EAAeE,MAAf,CAAd;AACA,aAAKC,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,MAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,IAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,IAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,MAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,KAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,OAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,MAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,MAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,IAA9B;AACA,aAAKA,WAAL,CAAiB,CAAjB,EAAmB,UAAnB,EAA8B,MAA9B;AACH,KAtJI;AAwJLA,eAxJK,uBAwJO5B,IAxJP,EAwJY6B,IAxJZ,EAwJiBhD,QAxJjB,EAwJ0B;AAC3B,YAAIiD,QAAQ;AACRvB,oBAAOsB,IADC;AAERhD,sBAASA;AAFD,SAAZ;AAIA,aAAKuB,MAAL,CAAYJ,IAAZ,EAAkB+B,IAAlB,CAAuBD,KAAvB;AACH;AA9JI,CAAT","file":"lanuch.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {               \n        content:cc.Node,\n        prefabs:[cc.Prefab],\n        selfNode:cc.Node,\n        rng:[cc.SpriteFrame],\n        stamp:[cc.SpriteFrame],        \n    },\n\n    start () {\n        this.loadRobotInfo();        \n        this._show();        \n        wx.onMessage(data => {\n            this.currScore = parseInt(data.message);\n            this.friendUrl = data.url;            \n            wx.getUserCloudStorage({\n                keyList:['score'],\n                success:this.getUserCloudStorage.bind(this),\n            });\n        });       \n    },\n\n    _show () {\n        this.content.removeAllChildren(); \n        wx.getUserInfo({\n            openIdList:['selfOpenId'],\n            success:this.getUserInfo.bind(this),\n        });               \n    },\n\n    getUserInfo:function(info){\n        this.userInfo = info.data[0];\n        wx.getFriendCloudStorage({\n            keyList:['score','avatar4'],\n            success:this.getFriendCloudStorage.bind(this),            \n        });          \n    },\n\n    getFriendCloudStorage:function(info){    \n        console.log(\"info \",info);\n        if(info.length <= 0) return;      \n        for(var k = 0; k < info.data.length-1; k++){\n            for(var j = 0;j < info.data.length-1-k; j++){ \n                var score = parseInt(info.data[j].KVDataList[0].value);\n                var score2 = parseInt(info.data[j+1].KVDataList[0].value);                \n                if(score<score2){\n                    var temp = info.data[j+1];\n                    info.data[j+1] = info.data[j];\n                    info.data[j] = temp;\n                } \n            \n            }\n        }\n\n        for(var i = 0;i < info.data.length;i++){\n            var panel = null;\n            (i+2)%2 == 0?panel = cc.instantiate(this.prefabs[0]):panel = cc.instantiate(this.prefabs[1]);\n            this.writeInfo(panel,info.data[i],i);                           \n            if(info.data[i].nickname == this.userInfo.nickName){\n                this.writeInfo(this.selfNode,info.data[i],i);\n            }\n            panel.parent = this.content;           \n        }\n    },\n\n    writeInfo(node,info,i){        \n        var sprite = node.getChildByName(\"avatar\").getComponent(cc.Sprite);\n        this.createImage(sprite,info.avatarUrl);\n        node.getChildByName(\"name\").getComponent(cc.Label).string = info.nickname;\n        node.getChildByName(\"score\").getComponent(cc.Label).string = info.KVDataList[0].value;            \n        node.getChildByName(\"rank\").getComponent(cc.Label).string = (i+1).toString();        \n        if(i<3)\n        node.getChildByName(\"rank2\").getComponent(cc.Sprite).spriteFrame = this.rng[i];\n        var range = Math.floor(info.KVDataList[0].value/200);\n        if(range<4)\n        node.getChildByName(\"stamp\").getComponent(cc.Sprite).spriteFrame = this.stamp[range];               \n        if(info.KVDataList[1]){           \n            var obj = JSON.parse(info.KVDataList[1].value);        \n            if(obj.type == 0){                \n                var g = this.userInfo.gender;\n                if(g == 0)\n                g = 1;\n                var robotInfo = this.robots[g - 1][obj.value];\n                var sprite3 = node.getChildByName('avatar2').getComponent(cc.Sprite);\n                this.setSprite(sprite3,robotInfo.avatar);            \n            }else{\n                var sprite2 = node.getChildByName('avatar2').getComponent(cc.Sprite);\n                this.createImage(sprite2,obj.value);\n            }\n        }\n    },\n\n    setSprite(sprite,icon){\n        cc.loader.loadRes(icon, cc.SpriteFrame, function (err, spriteFrame) {\n            sprite.spriteFrame = spriteFrame;\n        });\n    },\n    \n    createImage: function(sprite, url){\n        if(url){\n            let image = wx.createImage();       \n            image.onload = function () {\n                let texture = new cc.Texture2D();\n                texture.initWithElement(image);\n                texture.handleLoadedTexture();\n                sprite.spriteFrame = new cc.SpriteFrame(texture);                \n            };\n            image.src = url;\n        }                \n    },\n\n    getUserCloudStorage:function(data){\n        var maxScore = 0;\n        if(data.KVDataList[0]){\n            var maxScore = parseInt(data.KVDataList[0].value);\n        }        \n        if(this.currScore > maxScore){\n            var obj = {\n                key:\"score\",\n                value:this.currScore.toString(),\n            }\n \n            var obj2 = {\n                key:\"avatar4\",\n                value:this.friendUrl,\n            }\n            lx.setUserCloudStorage({\n                KVDataList:[obj,obj2],               \n              \n            });            \n            this._show();\n        }                     \n    },\n\n    loadRobotInfo(){\n        var male = new Array();\n        var female = new Array();\n        this.robots = new Array(male,female);        \n        this.createRobot(1,'avatar/0','無悪不作');        \n        this.createRobot(0,'avatar/1','兔兔');\n        this.createRobot(1,'avatar/2','佛爷');\n        this.createRobot(1,'avatar/3','吧唧先生');\n        this.createRobot(0,'avatar/4','小兔几');\n        this.createRobot(0,'avatar/5','很酷只撩你');\n        this.createRobot(1,'avatar/6','油焖大侠');\n        this.createRobot(0,'avatar/7','浅浅淡淡');\n        this.createRobot(0,'avatar/8','柒七');\n        this.createRobot(0,'avatar/9','灯下孤影');\n    },\n\n    createRobot(type,path,nickName){    \n        var robot = {\n            avatar:path,\n            nickName:nickName,\n        };\n        this.robots[type].push(robot);\n    },    \n    \n});\n"]}