var LayaAir3D=function(){function e(){Laya.MiniAdpter.init(!0,!1),Laya3D.init(640,1136,Laya.WebGL),Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH,Laya.stage.screenMode=Laya.Stage.SCREEN_NONE,lx.config.set({gameid:100100});var e={scope:"scope.userInfo",before:function(){lx.log("before")},after:function(){lx.log("after")},fail:function(){lx.authorize(e)},success:function(){lx.login({success:function(e){},fail:function(e){}})}};lx.authorize(e),Laya.stage.bgColor="#888",console.log("我是主域加载完成"),Laya.Stat.show(),Laya.loader.create([{url:"res/LayaScene_ball/ball.lh"},{url:"res/LayaScene_fly/fly.lh"},{url:"res/LayaScene_target/target.lh"}],Laya.Handler.create(this,this.on3DComplete))}var a=e.prototype;return a.on3DComplete=function(){this.currClickX=0,this.speedX=.04,e.floorList=[],e.deathList=[],e.dieFloorList=[],e.dieDeathList=[],e.cylindeList=[],e.cylindepoolList=[],Config.istake=!0,this.createScene(),this.createSceneSmoke(),this.createCamera(),this.createLight(),this.createBall(),this.deathBorder(-7,-1.2),this.createThing(),this.createView(),this.showSon(),this.addlisten()},a.createTween=function(){var e=Laya.stage.width-400>>1,a="",t=new Laya.Box;t.name="thebox",Laya.startView.removeChildByName("thebox");for(var i=0,r="滚粗天际".length;i<r;++i)(a=function(e,a){var t=new Laya.Text;return t.text=e,t.color="#ffffff",t.font="Impact",t.bold=!0,t.fontSize=80,a.addChild(t),Laya.startView.addChild(a),t}("滚粗天际".charAt(i),t)).x=400/r*i+e,a.y=100,Laya.Tween.to(a,{y:300},1e3,Laya.Ease.elasticOut,null,100*i)},a.showSon=function(){Laya.Browser.onWeiXin?(Laya.Browser.window.sharedCanvas.width=640,Laya.Browser.window.sharedCanvas.height=1136,Laya.timer.once(10,this,function(a){lx.postMessage({message:JSON.stringify({tag:"setSize",data:{width:Laya.stage.width,height:Laya.stage.height,matrix:Laya.stage._canvasTransform}})}),e.subTexture=new Laya.Texture(Laya.Browser.window.sharedCanvas),(e.subContextSprite=new Laya.Sprite).size(640,1136),e.subContextSprite.visible=!1,Laya.stage.addChild(e.subContextSprite),e.subContextSprite.graphics.drawTexture(e.subTexture,0,0,640,1136)})):onLoad()},a.showRank=function(a){lx.postMessage({message:JSON.stringify({tag:a})}),Laya.Browser.onWeiXin&&(e.subTexture.bitmap.alwaysChange=!0,e.subContextSprite.visible=!0)},a.hideRank=function(a){lx.postMessage({message:JSON.stringify({tag:a})}),Laya.Browser.onWeiXin&&(e.subTexture.bitmap.alwaysChange=!1,e.subContextSprite.visible=!1)},a.createScene=function(){e.scene=new Laya.Scene,Laya.stage.addChild(e.scene)},a.createSceneSmoke=function(){e.scene.enableFog=!0,e.scene.fogColor=new Laya.Vector3(.53,.53,.53),e.scene.fogStart=4,e.scene.fogRange=18},a.createBall=function(){e.unity3D=Laya.loader.getRes("res/LayaScene_ball/ball.lh"),e.scene.addChild(e.unity3D);var a=e.unity3D.clone();e.ballSp=a.getChildByName("ball01"),(e.ball=e.unity3D.getChildByName("ball01")).addChild(e.ballSp);var t=lx.getStorageSync("skinBallNow"),i="";i=t||Config.skinBallNow,lx.setStorageSync("skinBallNow",i);var r=new Laya.StandardMaterial;r.albedo=new Laya.Vector4(1,1,1,0),r.renderMode=5,e.ball.meshRender.material=r,e.ball.transform.position=new Laya.Vector3(0,.1,0);var n=new Laya.StandardMaterial;n.diffuseTexture=Laya.Texture2D.load("res/ballSkin/"+i+".jpg"),n.specularColor=new Laya.Vector4(0,0,0,1),e.ballSp.meshRender.material=n,e.ballSp.transform.position=new Laya.Vector3(0,.1,0),e.ball.addChild(this.createBallFly())},a.createBallFly=function(){var e=Laya.loader.getRes("res/LayaScene_fly/fly.lh").clone(),a=e.getChildByName("fly"),t=e.getChildByName("fly").getChildByName("joint1").getChildByName("top"),i=e.getChildByName("fly").getChildByName("bottom");a.transform.rotate(new Laya.Vector3(-20,0,0),!1,!1),a.transform.position=new Laya.Vector3(0,.1,0);var r=new Laya.StandardMaterial;return r.diffuseTexture=Laya.Texture2D.load("res/flySkin/fly01.jpg"),r.albedo=new Laya.Vector4(1,1,1,0),r.renderMode=5,t.meshRender.material=r,i.meshRender.material=r,e},a.createCamera=function(){(e.camera=new Laya.Camera(0,.1,50)).transform.translate(new Laya.Vector3(0,1.6,1.1),!0),e.camera.transform.rotate(new Laya.Vector3(-40,0,0),!1,!1),e.camera.clearColor=null,e.scene.addChild(e.camera)},a.createLight=function(){this.directionLight=new Laya.DirectionLight,this.directionLight.color=new Laya.Vector3(1,1,1),this.directionLight.direction=new Laya.Vector3(0,-20,-10),this.directionLight.diffuseColor=new Laya.Vector3(1,1,1),this.directionLight.specularColor=new Laya.Vector3(.1,.1,.1),e.scene.addChild(this.directionLight)},a.createStep=function(a,t){for(var i=0;i<4;i++){var r=laya.utils.Pool.getItemByClass("floor",Floor),n=r.add();r.setPos(i,0,a,t,!0),e.scene.addChild(n),e.floorList.push(r),e.dieFloorList.push(n.transform.position)}},a.spawnStep=function(a,t){var i=laya.utils.Pool.getItemByClass("floor",Floor),r=i.step?i.step:i.add();i.setPos(0,0,a,t,!1),e.scene.addChild(r),i.addProp(),e.floorList.push(i),e.dieFloorList.push(r.transform.position)},a.deathBorder=function(a,t){for(var i=0;i<4;i++){var r=laya.utils.Pool.getItemByClass("death",Death),n=r.add();r.setPos(i,a,t),e.deathList.push(r),e.dieDeathList.push(n.transform.position),e.scene.addChild(n)}},a.spawnDeathBorder=function(a,t){var i=laya.utils.Pool.getItemByClass("death",Death),r=i.borderDeath?i.borderDeath:i.add();i.setPos(0,a,t),e.deathList.push(i),e.dieDeathList.push(r.transform.position),e.scene.addChild(r)},a.createThing=function(){Laya.loader.create([{url:"res/LayaScene_step/step.lh"},{url:"res/LayaScene_stepBreak/stepBreak.lh"},{url:"res/LayaScene_speedUp/speedUp.lh"},{url:"res/LayaScene_speedDn/speedDn.lh"},{url:"res/LayaScene_mushRoom/mushRoom.lh"},{url:"res/LayaScene_spring/spring.lh"},{url:"res/LayaScene_fly/fly.lh"}],Laya.Handler.create(this,this.createStep,[-.12,-1.3])),Laya.loader.create("res/LayaScene_mountain/mountain.lh",Laya.Handler.create(this,this.createCylinder,[.8,-6,-4]))},a.createCylinder=function(a,t,i){for(var r,n,s=0;s<8;s++)e.cylindepoolList.length>=30&&(r=e.cylindepoolList.shift(),laya.utils.Pool.recover("cylinder_left",r),n=e.cylindepoolList.shift(),laya.utils.Pool.recover("cylinder_right",n)),!(r=laya.utils.Pool.getItemByClass("cylinder_left",Cylinder)).cylinder&&r.init(0),e.cylindepoolList.push(r),e.scene.addChild(r.cylinder),r.setPos(s,-a,t,i),!(n=laya.utils.Pool.getItemByClass("cylinder_right",Cylinder)).cylinder&&n.init(1),e.cylindepoolList.push(n),e.scene.addChild(n.cylinder),n.setPos(s,a,t,i);r&&(e.cylindeList[0]=r.cylinder.transform.position)},a.createTarget=function(a,t){for(var i=1;i<7;i++){var r=Laya.loader.getRes("res/LayaScene_target/target.lh").clone();e.scene.addChild(r),target=r.getChildByName("target");var n=0;n=Math.random()>.5?.3:-.3,target.transform.position=new Laya.Vector3(Math.random()*n,a-4.06*i,t-5.2*i),target.transform.rotate(new Laya.Vector3(-20,0,0),!1,!1);var s=new Laya.StandardMaterial;s.diffuseTexture=Laya.Texture2D.load("res/targetSkin/target01.jpg"),s.albedo=new Laya.Vector4(1,1,1,.8),s.renderMode=5,target.meshRender.material=s}},a.createView=function(){Laya.gameView=new GameView,Laya.stage.addChild(Laya.gameView),this.timered=null,Laya.startView=new StartView,Laya.startView.visible=!1,Laya.stage.addChild(Laya.startView);var a=lx.getStorageSync("isStart"),t=this;"0"==a&&a?(Laya.startView.visible=!1,e.ball.addComponent(BallScript),lx.setStorageSync("isStart","1")):(Laya.startView.visible=!0,this.createTween(),clearInterval(this.timered),this.timered=setInterval(function(){t.createTween()},5e3));lx.getStorageSync("reliveCoins")||lx.setStorageSync("reliveCoins",JSON.stringify({reliveCoins:0,istake:"true"}));lx.getStorageSync("ballNameCfg")||lx.setStorageSync("ballNameCfg",JSON.stringify(Config.ballNameCfg)),Laya.gameOver=new GameOver,Laya.gameOver.visible=!1,Laya.stage.addChild(Laya.gameOver),Laya.rankViewMain=new RankViewMain,Laya.rankViewMain.visible=!1,Laya.stage.addChild(Laya.rankViewMain)},a.addlisten=function(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)},a.offAddlisten=function(){Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)},a.onMouseDown=function(e){this.baseClickX=e.stageX},a.onMouseUp=function(e){},a.onMouseMove=function(a){e.ballPosX=e.ball.transform.position.x;var t=a.stageX-this.baseClickX;if(t>0){if(e.ballPosX>.6)return void(e.ball.transform.position.x=.6)}else if(e.ballPosX<-.6)return void(e.ball.transform.position.x=-.6);e.ball.transform.translate(new Laya.Vector3(t/500,0,0),!1),this.baseClickX=a.stageX},e}();new LayaAir3D;