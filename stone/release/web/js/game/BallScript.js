var BallScript=function(a){function e(){e.super(this)}Laya.class(e,"BallScript",a);var t=e.prototype;return t._load=function(a){this.ball=this.owner,this.camera=LayaAir3D.camera,this.fly3DSp=LayaAir3D.fly3DSp,this.id=Math.random(),this.dieFloorList=LayaAir3D.dieFloorList,this.cylindeList=LayaAir3D.cylindeList,this.speedZ=-.08,this.garvatiy=-.08,this.garvatiyCa=-.08,this.duration=5,this.garvkeep=0,this.maskFlag=!1,this.speedUpFlag=!0,this.speedDnFlag=!0,this.jumpFlag=!1,this.flyFlag=!1,this.speedUpZ=this.speedDnZ=-.08,this.speedGa=0,this.jumpSpeedY=.1,this.flySpeedY=.1,this.ball.transform.translate(new Laya.Vector3(0,-.1,0),!1),this.liveFlag=!0,this.ballRoate=-15,this.jumpTimes=0,this.jumpNums=3,this.speedTimes=0,this.speedNums=3},t._update=function(a){this.onFrameLoop(),this.liveFlag&&(Laya.gameView.score.text=Number(Laya.gameView.score.text)+1,this.awardShow(Laya.gameView.score.text))},t.onFrameLoop=function(){LayaAir3D.ballSp.transform.rotate(new Laya.Vector3(this.ballRoate,0,0),!1,!1),LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1]&&this.ball.transform.position.z<LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1].z+12&&(this.removeStep(),LayaAir3D.prototype.spawnStep(LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1].y-4,LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1].z-5.1),LayaAir3D.prototype.spawnDeathBorder(LayaAir3D.dieDeathList[LayaAir3D.dieDeathList.length-1].y-4,LayaAir3D.dieDeathList[LayaAir3D.dieDeathList.length-1].z-5.1)),LayaAir3D.cylindeList[0]&&this.ball.transform.position.z<LayaAir3D.cylindeList[0].z+30&&LayaAir3D.prototype.createCylinder(.8,LayaAir3D.cylindeList[0].y-3,LayaAir3D.cylindeList[0].z-4)},t.removeStep=function(){for(;LayaAir3D.floorList.length>5;){var a=LayaAir3D.floorList.shift();LayaAir3D.dieFloorList.shift(),laya.utils.Pool.recover("floor",a);var e=LayaAir3D.deathList.shift();LayaAir3D.dieDeathList.shift(),laya.utils.Pool.recover("death",e)}},t.awardShow=function(a){Number(a);var e,t=lx.getStorageSync("skinListData"),i=lx.getStorageSync("ballNameCfg"),s=JSON.parse(i);e=t?JSON.parse(t):Config.skinList;for(var r=0;r<e.length;r++){var o=e[r],n=s[r];Number(o.coinNums)==a&&0==n.flag&&(Laya.gameView.giftTip.text="恭喜解锁"+n.name,s[r].flag=1,Laya.gameView.giftTip.visible=!0,setTimeout(function(){Laya.gameView.giftTip.visible=!1},1e3))}lx.setStorageSync("ballNameCfg",JSON.stringify(s))},t.onTriggerEnter=function(a){switch(a.owner.name){case"paodao":this.beginFunPaodao(a);break;case"jiasu":this.beginFunJiasu(a);break;case"jiansu":this.beginFunJiansu(a);break;case"mushroom":this.beginFunMash(a);break;case"tiaoyue":this.beginFunTiaoyue(a);break;case"fly":this.beginFunFly(a);break;case"death":this.beginFunLive(a)}},t.onTriggerStay=function(a){},t.onTriggerExit=function(a){switch(a.owner.name){case"paodao":this.endFunPaodao(a);break;case"jiasu":this.endFunJiasu(a);break;case"jiansu":this.endFunJiansu(a);break;case"mushroom":this.endFunMash(a);break;case"tiaoyue":this.endFunTiaoyue(a)}},t.beginFunPaodao=function(a){console.log("碰撞跑道开始"),this.ballRoate=-15;this.ball.getComponentByType(Laya.SphereCollider).radius,a.owner.getComponentByType(Laya.BoxCollider).size.y;this.ball.transform.position.y-a.owner.transform.position.y<.5&&(this.camera.transform.translate(new Laya.Vector3(0,.1,0),!1),this.ball.transform.translate(new Laya.Vector3(0,.1,0),!1)),this.garvatiyCa=this.garvatiy=0,this.speedZ=-.08,Laya.timer.loop(this.duration,this,this.onLoop)},t.endFunPaodao=function(a){this.garvatiyCa=this.garvatiy=-.12,this.speedZ=-.08,0==a.owner.coliobj.tag&&(a.owner.coliobj.tag=1),Laya.timer.loop(this.duration,this,this.onLoop)},t.beginFunJiasu=function(a){console.log("碰撞加速带开始"),this.maskFlag=!0,this.speedUpFlag=!1,this.ballRoate=-30,this.speedTimes++,this.speedTimes==this.speedNums&&(this.speedTimes=0,this.speedUpZ=-.12,console.log("第"+this.speedNums+"个")),Laya.timer.loop(this.duration,this,this.onSpeedUp)},t.endFunJiasu=function(a){var e=this;this.speedUpFlag||setTimeout(function(){e.maskFlag=!1,e.speedUpFlag=!0,e.speedUpZ=-.08,e.speedGa=0},1660)},t.beginFunJiansu=function(a){this.maskFlag=!0,this.speedDnFlag=!1,this.ballRoate=-10,Laya.timer.loop(this.duration,this,this.onSpeedDn),Laya.Browser.onWeiXin&&(lx.vibrateShort(),setTimeout(function(){lx.vibrateShort()},15))},t.endFunJiansu=function(a){var e=this;this.speedDnFlag||setTimeout(function(){e.maskFlag=!1,e.speedDnFlag=!0,e.speedDnZ=-.04,e.speedZ=-.07},200)},t.beginFunMash=function(a){var e=this;setTimeout(function(){a.owner&&a.owner.destroy()},20);this.timer2&&clearTimeout(this.timer2),"mushRoomRed"==a.owner.theName?(this.ball.transform.scale=new Laya.Vector3(1.5,1.5,1.5),this.ball.transform.translate(new Laya.Vector3(0,.1,0),!1),this.camera.transform.translate(new Laya.Vector3(0,.1,0),!1)):"mushRoomGn"==a.owner.theName&&(this.ball.transform.scale=new Laya.Vector3(.5,.5,.5)),this.timer2=setTimeout(function(){e.ball.transform.scale=new Laya.Vector3(1,1,1)},2e3)},t.endFunMash=function(a){},t.beginFunTiaoyue=function(a){this.maskFlag=!0,this.jumpFlag=!1,this.jumpTimes++,this.jumpTimes==this.jumpNums&&(this.jumpTimes=0,this.jumpSpeedY=.12),Laya.timer.loop(this.duration,this,this.onJump)},t.endFunTiaoyue=function(a){var e=this;setTimeout(function(){e.maskFlag=!1,e.jumpFlag=!0,e.jumpSpeedY=0,e.garvatiyCa=e.garvatiy=0,e.speedZ=-.08},600),setTimeout(function(){e.speedZ=-.12,e.garvatiyCa=e.garvatiy=-.24},750)},t.beginFunFly=function(a){this.maskFlag=this.speedUpFlag=this.speedDnFlag=!0,this.flyFlag=!1,this.ballRoate=0,this.ball.transform.scale=new Laya.Vector3(1,1,1),Laya.timer.loop(this.duration,this,this.onFly);var e=this.ball.getChildByName("fly"),t=e.getChildByName("fly").getChildByName("joint1").getChildByName("top"),i=e.getChildByName("fly").getChildByName("bottom"),s=new Laya.StandardMaterial;s.diffuseTexture=Laya.Texture2D.load("res/flySkin/fly01.jpg"),s.albedo=new Laya.Vector4(1,1,1,1),s.renderMode=5,t.meshRender.material=s,i.meshRender.material=s,setTimeout(function(){a.owner.destroy()},100)},t.endFunFly=function(a){var e=this;setTimeout(function(){e.flyFlag=!0,console.log(e.ball.transform.position);var a=e.ball.transform.position;LayaAir3D.prototype.createTarget(a.y,a.z),Laya.timer.loop(e.duration,e,e.onSky)},600)},t.onTarget=function(a,e){console.log(a,e),LayaAir3D.prototype.createTarget(a,e)},t.beginFunLive=function(a){this.liveFlag=!1;var e={myScore:Laya.gameView.score.text};lx.setStorageSync("myInfo",JSON.stringify(e)),Config.istake?(this.speedZ=0,this.garvatiyCa=0,this.garvatiy-=.01,this.ballRoate=0,Laya.reliveView=new ReliveView,Laya.stage.addChild(Laya.reliveView)):this.beginFunDeath(a)},t.beginFunDeath=function(a){this.speedZ=0,this.garvatiyCa=0,this.garvatiy-=.01,setTimeout(function(){Laya.gameOver.visible=!0,Laya.gameOver.endScore.text="最终得分："+Laya.gameView.score.text,lx.postMessage({message:JSON.stringify({tag:"postUserScore",data:{score:Laya.gameView.score.text}})});var a=lx.getStorageSync("highScore");a?(Number(a)<Number(Laya.gameView.score.text)&&lx.setStorageSync("highScore",Laya.gameView.score.text),Laya.gameOver.hisScore.text="历史最高分："+a):(Laya.gameOver.hisScore.text="历史最高分：0",lx.setStorageSync("highScore",Laya.gameView.score.text));var e,t=Laya.gameView.score.text,i=lx.getStorageSync("skinListData");e=i?JSON.parse(i):Config.skinList;for(var s=0;s<e.length;s++){var r=e[s];0==r.btnStatus&&r.coinNums<=Number(t)&&(r.btnStatus=2,e[s]=r)}lx.setStorageSync("skinListData",JSON.stringify(e)),lx.postMessage({message:JSON.stringify({tag:"getUserScore"})}),LayaAir3D.prototype.showRank("getSmallRankList")},600)},t.onkeep=function(){this.maskFlag||(this.garvkeep-=.01,this.camera.transform.translate(new Laya.Vector3(0,-this.garvkeep,0),!1),this.ball.transform.translate(new Laya.Vector3(0,-this.garvkeep,0),!1))},t.onLoop=function(){this.maskFlag||(this.camera.transform.translate(new Laya.Vector3(0,this.garvatiyCa,this.speedZ),!1),this.ball.transform.translate(new Laya.Vector3(0,this.garvatiy,this.speedZ),!1))},t.onSpeedUp=function(){this.speedUpFlag||(this.speedGa-=.002,this.speedUpZ-=.001,this.camera.transform.translate(new Laya.Vector3(0,this.speedGa,this.speedUpZ),!1),this.ball.transform.translate(new Laya.Vector3(0,this.speedGa,this.speedUpZ),!1))},t.onSpeedDn=function(){this.speedDnFlag||(this.speedDnZ+=.001,this.camera.transform.translate(new Laya.Vector3(0,0,this.speedDnZ),!1),this.ball.transform.translate(new Laya.Vector3(0,0,this.speedDnZ),!1))},t.onJump=function(){this.jumpFlag||(this.jumpSpeedY+=.009,this.camera.transform.translate(new Laya.Vector3(0,this.jumpSpeedY,0),!1),this.ball.transform.translate(new Laya.Vector3(0,this.jumpSpeedY,0),!1))},t.onFly=function(){this.flyFlag||(this.flySpeedY+=.004,this.camera.transform.translate(new Laya.Vector3(0,this.flySpeedY,0),!1),this.ball.transform.translate(new Laya.Vector3(0,this.flySpeedY,0),!1))},t.onSky=function(){this.camera.transform.translate(new Laya.Vector3(0,-.094,-.12),!1),this.ball.transform.translate(new Laya.Vector3(0,-.094,-.12),!1)},e}(Laya.Script);