var BallScript=function(a){function e(){e.super(this)}Laya.class(e,"BallScript",a);var t=e.prototype;return t._load=function(a){this.ball=this.owner,this.camera=LayaAir3D.camera,this.id=Math.random(),this.dieFloorList=LayaAir3D.dieFloorList,this.cylindeList=LayaAir3D.cylindeList,this.speedZ=-.08,this.garvatiy=-.12,this.garvatiyCa=-.12,this.keepFlag=!1,this.fallFlag=!1,this.pengFlag=!0,this.duration=5,this.lastStamp=0,this.maskFlag=!1,this.speedUpFlag=!0,this.speedDnFlag=!0,this.mushFlag=!1,this.jumpFlag=!1,this.speedUpZ=this.speedDnZ=-.08,this.speedGa=0,this.jumpSpeedY=.1,this.ball.transform.translate(new Laya.Vector3(0,-.1,0),!1),this.score=Laya.gameView.score.text,this.scoreFlag=!0,this.ballRoate=-15,this.jumpTimes=0,this.jumpNums=3,this.speedTimes=0,this.speedNums=3},t._update=function(a){this.onkeep(),this.onFall(),this.onFrameLoop(),Laya.gameOver.visible||(Laya.gameView.score.text=Number(Laya.gameView.score.text)+1)},t.onFrameLoop=function(){LayaAir3D.ball.transform.rotate(new Laya.Vector3(this.ballRoate,0,0),!1,!1),LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1]&&this.ball.transform.position.z<LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1].z+12&&(this.removeStep(),LayaAir3D.prototype.spawnStep(LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1].y-4,LayaAir3D.dieFloorList[LayaAir3D.dieFloorList.length-1].z-5.1),LayaAir3D.prototype.spawnDeathBorder(LayaAir3D.dieDeathList[LayaAir3D.dieDeathList.length-1].y-4,LayaAir3D.dieDeathList[LayaAir3D.dieDeathList.length-1].z-5.1)),LayaAir3D.cylindeList[0]&&this.ball.transform.position.z<LayaAir3D.cylindeList[0].z+30&&LayaAir3D.prototype.createCylinder(.8,LayaAir3D.cylindeList[0].y-3,LayaAir3D.cylindeList[0].z-4)},t.removeStep=function(){for(;LayaAir3D.floorList.length>5;){var a=LayaAir3D.floorList.shift();LayaAir3D.dieFloorList.shift(),laya.utils.Pool.recover("floor",a);var e=LayaAir3D.deathList.shift();LayaAir3D.dieDeathList.shift(),laya.utils.Pool.recover("death",e)}},t.onTriggerEnter=function(a){void 0!==Laya.stage._childs[1]&&(Laya.stage._childs[1].text=Number(Laya.stage._childs[1].text)+1);var e=a.owner.name;if("paodao"==e&&Config.isStart)this.beginFunPaodao(a);else if("jiasu"==e)this.beginFunJiasu(a);else if("jiansu"==e)this.beginFunJiansu(a);else if("mushroom"==e){var t=this;setTimeout(function(){a.owner&&a.owner.destroy()},20);this.timer2&&clearTimeout(this.timer2),"mushRoomRed"==a.owner.theName?(this.ball.transform.scale=new Laya.Vector3(1.5,1.5,1.5),this.ball.transform.translate(new Laya.Vector3(0,.1,0),!1),this.camera.transform.translate(new Laya.Vector3(0,.1,0),!1)):"mushRoomGn"==a.owner.theName&&(this.ball.transform.scale=new Laya.Vector3(.5,.5,.5)),this.timer2=setTimeout(function(){t.ball.transform.scale=new Laya.Vector3(1,1,1)},2e3)}else"tiaoyue"==e?this.beginFunTiaoyue(a):"death"==e&&this.beginFunDeath(a)},t.onTriggerStay=function(a){},t.onTriggerExit=function(a){var e=a.owner.name;"paodao"==e&&(this.fallFlag=!1,0==a.owner.coliobj.tag&&(a.owner.coliobj.tag=1))},t.beginFunPaodao=function(a){console.log("碰撞跑道开始"),this.fallFlag=!0,this.ballRoate=-15;this.ball.getComponentByType(Laya.SphereCollider).radius,a.owner.getComponentByType(Laya.BoxCollider).size.y,this.ball.transform.position.y,a.owner.transform.position.y;this.pengFlag=!0},t.beginFunJiasu=function(a){console.log("碰撞加速带开始"),this.speedZ+=-.01,this.garvatiy+=-.01,this.garvatiyCa+=-.01,this.maskFlag=!0,this.speedUpFlag=!1,this.ballRoate=-30,this.speedTimes++,this.speedTimes==this.speedNums&&(this.speedTimes=0,this.speedUpZ=-.12,console.log("第"+this.speedNums+"个"))},t.beginFunJiansu=function(a){this.speedZ-=-.01,this.garvatiy+=.01,this.garvatiyCa+=.01,this.maskFlag=!0,this.speedDnFlag=!1,this.ballRoate=-10,Laya.Browser.onWeiXin&&lx.vibrateLong()},t.beginFunTiaoyue=function(a){this.maskFlag=!0,this.jumpFlag=!1,this.jumpTimes++,this.jumpTimes==this.jumpNums&&(this.jumpTimes=0,this.jumpSpeedY=.12),Laya.timer.loop(this.duration,this,this.onJump)},t.beginFunDeath=function(a){console.log("碰到死亡边界");this.speedZ=0,this.garvatiyCa=0,this.garvatiy-=.01,setTimeout(function(){Laya.gameOver.visible=!0,Laya.gameOver.endScore.text="最终得分："+Laya.gameView.score.text,Laya.Browser.onWeiXin&&lx.postMessage({message:JSON.stringify({tag:"postUserScore",data:{score:Laya.gameView.score.text}})});var a=lx.getStorageSync("highScore");a?(Number(a)<Number(Laya.gameView.score.text)&&lx.setStorageSync("highScore",Laya.gameView.score.text),Laya.gameOver.hisScore.text="历史最高分："+a):(Laya.gameOver.hisScore.text="历史最高分：0",lx.setStorageSync("highScore",Laya.gameView.score.text)),Laya.Browser.onWeiXin&&(lx.postMessage({message:JSON.stringify({tag:"getUserScore"})}),LayaAir3D.prototype.showRank("getSmallRankList"))},600)},t.onChange=function(a,e,t){this.camera.transform.translate(new Laya.Vector3(a,e,t),!1),this.ball.transform.translate(new Laya.Vector3(a,e,t),!1)},t.onkeep=function(){console.log(this.speedZ),this.keepFlag||this.onChange(0,0,this.speedZ)},t.onFall=function(){this.fallFlag||(this.camera.transform.translate(new Laya.Vector3(0,this.garvatiyCa,0),!1),this.ball.transform.translate(new Laya.Vector3(0,this.garvatiy,0),!1))},t.onLoop=function(){this.maskFlag||(this.camera.transform.translate(new Laya.Vector3(0,this.garvatiyCa,this.speedZ),!1),this.ball.transform.translate(new Laya.Vector3(0,this.garvatiy,this.speedZ),!1))},t.onSpeedUp=function(){this.speedUpFlag||(this.speedGa-=.002,this.speedUpZ-=.001,this.camera.transform.translate(new Laya.Vector3(0,this.speedGa,this.speedUpZ),!1),this.ball.transform.translate(new Laya.Vector3(0,this.speedGa,this.speedUpZ),!1))},t.onSpeedDn=function(){this.speedDnFlag||(this.speedDnZ+=.001,this.camera.transform.translate(new Laya.Vector3(0,0,this.speedDnZ),!1),this.ball.transform.translate(new Laya.Vector3(0,0,this.speedDnZ),!1))},t.onJump=function(){this.jumpFlag||(this.jumpSpeedY+=.009,this.camera.transform.translate(new Laya.Vector3(0,this.jumpSpeedY,0),!1),this.ball.transform.translate(new Laya.Vector3(0,this.jumpSpeedY,0),!1))},e}(Laya.Script);